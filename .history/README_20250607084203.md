# Fail2Ban Notify - Go Implementation

A modern, multi-platform notification system for Fail2Ban written in Go. Send real-time security alerts to Discord, Microsoft Teams, Slack, Telegram, or custom webhooks when IPs are banned or unbanned.

## ‚ú® Features

- üöÄ **Multi-Platform Support**: Discord, Teams, Slack, Telegram, and custom webhooks
- üåç **Geographic Information**: Automatic IP geolocation with ISP details
- ‚öôÔ∏è **Easy Configuration**: JSON-based configuration with sensible defaults
- üîß **Custom Connectors**: Define your own notification endpoints
- üì¶ **Single Binary**: No dependencies, easy installation
- üéØ **Rich Notifications**: Formatted messages with embeds, colors, and detailed information
- üõ°Ô∏è **Secure**: No sensitive data stored in logs

## üöÄ Quick Installation

Install with a single command:

```bash
curl -fsSL https://raw.githubusercontent.com/YOUR_USERNAME/fail2ban-notify-go/main/install.sh | sudo bash
```

## üìã Manual Installation

### Prerequisites

- Fail2Ban installed and configured
- Root access for installation
- Go 1.19+ (if building from source)

### Build from Source

```bash
git clone https://github.com/YOUR_USERNAME/fail2ban-notify-go.git
cd fail2ban-notify-go
make install
```

### Download Pre-built Binary

```bash
# Download latest release
wget https://github.com/YOUR_USERNAME/fail2ban-notify-go/releases/latest/download/fail2ban-notify-linux-amd64
sudo install -m 755 fail2ban-notify-linux-amd64 /usr/local/bin/fail2ban-notify

# Copy action configuration
sudo cp configs/notify.conf /etc/fail2ban/action.d/

# Initialize configuration
sudo fail2ban-notify -init
```

## ‚öôÔ∏è Configuration

### Initialize Configuration

```bash
sudo fail2ban-notify -init
```

This creates `/etc/fail2ban/fail2ban-notify.json` with default settings.

### Configure Notification Services

Edit the configuration file:

```bash
sudo nano /etc/fail2ban/fail2ban-notify.json
```

#### Discord Configuration

```json
{
  "connectors": {
    "discord": {
      "type": "discord",
      "enabled": true,
      "settings": {
        "webhook_url": "https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN",
        "username": "Fail2Ban Security",
        "avatar_url": "https://example.com/security-bot-avatar.png"
      }
    }
  }
}
```

#### Microsoft Teams Configuration

```json
{
  "connectors": {
    "teams": {
      "type": "teams",
      "enabled": true,
      "settings": {
        "webhook_url": "https://your-tenant.webhook.office.com/webhookb2/YOUR_WEBHOOK_URL"
      }
    }
  }
}
```

#### Slack Configuration

```json
{
  "connectors": {
    "slack": {
      "type": "slack",
      "enabled": true,
      "settings": {
        "webhook_url": "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK",
        "channel": "#security",
        "username": "fail2ban",
        "icon_emoji": ":cop:"
      }
    }
  }
}
```

#### Telegram Configuration

```json
{
  "connectors": {
    "telegram": {
      "type": "telegram",
      "enabled": true,
      "settings": {
        "bot_token": "YOUR_BOT_TOKEN",
        "chat_id": "YOUR_CHAT_ID"
      }
    }
  }
}
```

#### Custom Webhook Configuration

```json
{
  "connectors": {
    "custom-api": {
      "type": "custom",
      "enabled": true,
      "settings": {
        "webhook_url": "https://your-api.com/webhooks/security",
        "header_Content-Type": "application/json",
        "header_Authorization": "Bearer YOUR_API_TOKEN",
        "template": "{\"event\": \"fail2ban\", \"ip\": \"{{.IP}}\", \"jail\": \"{{.Jail}}\", \"action\": \"{{.Action}}\", \"timestamp\": \"{{.Time}}\", \"location\": \"{{.City}}, {{.Country}}\", \"isp\": \"{{.ISP}}\"}"
      }
    }
  }
}
```

### Geographic Information

Configure IP geolocation services:

```json
{
  "geoip": {
    "enabled": true,
    "service": "ipapi",
    "api_key": ""
  }
}
```

**Available services:**
- `ipapi` (free, no API key required)
- `ipgeolocation` (requires API key)

## üîß Fail2Ban Integration

### Add Notification Action to Jails

Edit `/etc/fail2ban/jail.local`:

```ini
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
findtime = 600
action = iptables[name=SSH, port=ssh, protocol=tcp]
         notify

[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 1800
action = iptables[name=nginx-http-auth, port=http, protocol=tcp]
         notify
```

### Restart Fail2Ban

```bash
sudo systemctl restart fail2ban
sudo systemctl status fail2ban
```

## üß™ Testing

### Test Notifications

```bash
# Test ban notification
sudo fail2ban-notify -ip="192.168.1.100" -jail="test" -action="ban" -failures="5" -debug

# Test unban notification
sudo fail2ban-notify -ip="192.168.1.100" -jail="test" -action="unban" -debug
```

### Monitor Fail2Ban Logs

```bash
# Watch for notification events
sudo tail -f /var/log/fail2ban.log | grep notify

# Check fail2ban status
sudo fail2ban-client status
```

## üìù Command Line Options

```bash
fail2ban-notify [options]

Options:
  -ip string
        IP address that was banned/unbanned
  -jail string
        Fail2ban jail name
  -action string
        Action performed (ban/unban) (default "ban")
  -failures int
        Number of failures
  -config string
        Path to configuration file (default "/etc/fail2ban/fail2ban-notify.json")
  -init
        Initialize configuration file
  -debug
        Enable debug logging
```

## üîç Troubleshooting

### Common Issues

**No notifications received:**
1. Check configuration file permissions: `sudo chmod 644 /etc/fail2ban/fail2ban-notify.json`
2. Verify webhook URLs are correct
3. Test with debug mode: `sudo fail2ban-notify -debug -ip="test" -jail="test"`

**Permission denied errors:**
1. Ensure binary is executable: `sudo chmod +x /usr/local/bin/fail2ban-notify`
2. Check fail2ban can execute the binary: `sudo -u fail2ban /usr/local/bin/fail2ban-notify -help`

**Geolocation not working:**
1. Check internet connectivity from fail2ban user
2. Verify API key for ipgeolocation service
3. Try switching to ipapi service (no key required)

### Debug Mode

Enable debug logging in configuration:

```json
{
  "debug": true
}
```

Or use command line flag:

```bash
sudo fail2ban-notify -debug -ip="192.168.1.100" -jail="sshd" -action="ban"
```

## üèóÔ∏è Development

### Building

```bash
# Install dependencies
make dev-setup

# Build for current platform
make build

# Build for all platforms
make build-all

# Run tests
make test

# Run linter
make lint
```

### Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/amazing-feature`
3. Commit your changes: `git commit -m 'Add amazing feature'`
4. Push to the branch: `git push origin feature/amazing-feature`
5. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- Original inspiration from [eyeskiller/fail2ban-ms-teams-notification](https://github.com/eyeskiller/fail2ban-ms-teams-notification)
- Fail2Ban community for the excellent security tool
- All contributors who help improve this project

## üìû Support

- üêõ **Issues**: [GitHub Issues](https://github.com/YOUR_USERNAME/fail2ban-notify-go/issues)
- üí¨ **Discussions**: [GitHub Discussions](https://github.com/YOUR_USERNAME/fail2ban-notify-go/discussions)
- üìß **Email**: your-email@example.com

---

‚≠ê **Star this repository if you find it useful!**